<div id="modal">

  <div class="modal modal-bot fade" id="modal-heart" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-body">
          <div class="page-header">
            <h2 class="page-title">送愛心</h2>
            <button type="button" class="btn btn-white btn-round page-close" data-bs-dismiss="modal" onclick="initHeart()"></button>
          </div>

          <div>
            <div class="form-body">
              <div class="form-section">
                <div class="form-group">
                  <div>贈送超過100顆愛心，立刻享有留言功能~</div>
                </div>
                <div class="form-group">
                  <div class="flex-center-a ch-gx-3">
                    <button type="button" class="btn btn-white btn-round" onclick="addHeart('-')"><img src="/static/common/img/svg/Minus.svg"></button>
                    <input id="heart-input" type="number" class="form-control" oninput="currentHeart()" value="1" style="width: 100px">
                    <button type="button" class="btn btn-white btn-round" onclick="addHeart('+')"><img src="/static/common/img/svg/Plus.svg"></button>
                  </div>
                </div>
              </div>
              <div id="heart-message-section" class="form-section">
                <div class="form-group">
                  <label class="form-label">留言</label>
                  <textarea class="form-control" rows="5" placeholder="分享自我介紹訊息增加興趣交流的機會" name="heart_message"></textarea>
                  <div class="form-desc">留言時請遵守留言規則。</div>
                </div>
              </div>
            </div>
            <div class="form-foot">
              <button type="button" class="btn btn-brand">送出</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal-bot fade" id="modal-hangout-step1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-body">
          <div class="page-header">
            <h2 class="page-title">邀約表單</h2>
            <button type="button" class="btn btn-white btn-round page-close" data-bs-dismiss="modal" onclick="initHangout()"></button>
          </div>
          <div>
            <input type="hidden" name="userId">
            <div class="form-body">
              <div class="form-group">
                <label class="form-label">要做什麼呢？</label>
                <div class="ch-g-2">
                  <label class="ckb ckbBox ckbHide">
                    <input type="radio" name="hangout_hobby" value="Coffee Chat">
                    <div>
                      <div class="img-text">
                        <img src="/static/common/img/svg/coffee.svg"> Coffee Chat
                      </div>
                    </div>
                  </label>
                  <label class="ckb ckbBox ckbHide">
                    <input type="radio" name="hangout_hobby" value="Outdoor activity">
                    <div>
                      <div class="img-text">
                        <img src="/static/common/img/svg/tree.svg"> Outdoor activity
                      </div>
                    </div>
                  </label>
                  <label class="ckb ckbBox ckbHide">
                    <input type="radio" name="hangout_hobby" value="Movie Time">
                    <div>
                      <div class="img-text">
                        <img src="/static/common/img/svg/movie.svg"> Movie Time
                      </div>
                    </div>
                  </label>
                  <label class="ckb ckbBox ckbHide">
                    <input type="radio" name="hangout_hobby" value="KTV Super Idol">
                    <div>
                      <div class="img-text">
                        <img src="/static/common/img/svg/microphone.svg"> KTV Super Idol
                      </div>
                    </div>
                  </label>
                  <label class="ckb ckbBox ckbHide">
                    <input type="radio" name="hangout_hobby" value="Foodie">
                    <div>
                      <div class="img-text">
                        <img src="/static/common/img/svg/foodie.svg"> Foodie
                      </div>
                    </div>
                  </label>
                  <label class="ckb ckbBox ckbHide">
                    <input type="radio" name="hangout_hobby" value="Concert">
                    <div>
                      <div class="img-text">
                        <img src="/static/common/img/svg/concert.svg"> Concert
                      </div>
                    </div>
                  </label>
                </div>
              </div>
            </div>
            <div class="form-foot">
              <button type="button" class="btn btn-brand" onclick="openModal_hangout2()">下一步</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal-bot fade" id="modal-hangout-step2" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-body">
          <div class="page-header">
            <button type="button" class="btn btn-white btn-round page-prev" onclick="openModal_hangout1()"></button>
            <h2 class="page-title">邀約表單</h2>
            <button type="button" class="btn btn-white btn-round page-close" data-bs-dismiss="modal" onclick="initHangout()"></button>
          </div>
          <div>
            <input type="hidden" name="userId">
            <div class="form-body">
              <div class="form-group">
                <label class="form-label">想約什麼時候呢？</label>
                <div class="flex-center-a">
                  <input type="date" name="hangout_date" class="form-control">
                  <div class="px-3">至</div>
                  <div class="text-nowrap">2022/1/3</div>
                </div>
                <div class="form-desc">每次邀約以設定日期後3天為一個期間，邀約開始日期最常不可超過14天。</div>
              </div>
              <div class="form-group">
                <label class="form-label">如何分攤？</label>
                <div class="ch-gy-2">
                  <div>
                    <label class="ckb">
                      <input type="radio" name="hangout_payType" value="treat">
                      <div>我請客</div>
                    </label>
                  </div>
                  <div>
                    <label class="ckb">
                      <input type="radio" name="hangout_payType" value="AA">
                      <div>AA制</div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-foot">
              <button type="button" class="btn btn-brand" onclick="openModal_hangout3()">下一步</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal-bot fade" id="modal-hangout-step3" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-body">
          <div class="page-header">
            <button type="button" class="btn btn-white btn-round page-prev" onclick="openModal_hangout2()"></button>
            <h2 class="page-title">邀約表單</h2>
            <button type="button" class="btn btn-white btn-round page-close" data-bs-dismiss="modal" onclick="initHangout()"></button>
          </div>
          <div>
            <input type="hidden" name="userId">
            <div class="form-body">
              <div class="form-group">
                此時段已被其他人邀約，建議提高津貼至少oooo元，以提高邀約成功的機會喔！
              </div>
              <div class="form-group">
                <label class="form-label">津貼<span class="ms-2 fw-n">可用額度: 5000</span></label>
                <input type="number" class="form-control" name="hangout_allowance">
              </div>
              <div class="form-group">
                <label class="form-label">使用coupon？</label>
                <input type="text" class="form-control" name="hangout_coupon">
              </div>
            </div>
            <div class="form-foot">
              <button type="button" class="btn btn-brand" @click="submitModal_hangout()">送出</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var hangout = {
      id: '',
      hobby: '',
      date: '',
      payType: '',
      allowance: 0,
      coupon: 0,
    }
    var heart = {
      id: '',
      input: 1,
      iSent: 1,
      message: 0,
    }
    var bsModal_hangout_step1 = new bootstrap.Modal( document.getElementById('modal-hangout-step1') )
    var bsModal_hangout_step2 = new bootstrap.Modal( document.getElementById('modal-hangout-step2') )
    var bsModal_hangout_step3 = new bootstrap.Modal( document.getElementById('modal-hangout-step3') )
    var bsModal_heart = new bootstrap.Modal( document.getElementById('modal-heart') )

    function openModal_hangout1( id ){
      hangout.id = id
      bsModal_hangout_step2.hide()
      let sto = setTimeout(()=>{
        bsModal_hangout_step1.show()
        clearTimeout(sto)
      })
    }
    function openModal_hangout2(){
      bsModal_hangout_step1.hide()
      bsModal_hangout_step3.hide()
      let sto = setTimeout(()=>{
        bsModal_hangout_step2.show()
        clearTimeout(sto)
      })
    }
    function openModal_hangout3(){
      bsModal_hangout_step2.hide()
      let sto = setTimeout(()=>{
        bsModal_hangout_step3.show()
        clearTimeout(sto)
      })
    }
    function openModal_heart( id, heartISent = 0 ){
      heart.id = id
      heart.iSent = heartISent
      show_HeartMessageSection()
      bsModal_heart.show()
    }
    function currentHeart(){
      let value = +$('[name=heart_input]').val()
      heart.input = !value || value < 0 ? 0 : value
      $('[name=heart_input]').val( heart.input )
      show_HeartMessageSection()
    }
    function show_HeartMessageSection(){
      if ( heart.iSent + heart.input >= 100 ){
        $('#heart-message-section').show()
      } else {
        $('#heart-message-section').hide()
      }
    }
    function initHeart(){
      heart = {
        id: '',
        input: 1,
        iSent: 0,
        message: '',
      }
      $('[name=heart_input]').val(heart.input)
      $('[name=heart_message]').text(heart.message)
    }
    function initHangout(){
      hangout = {
        id: '',
        hobby: '',
        date: '',
        payType: '',
        allowance: 0,
        coupon: 0,
      }
      $('[name=hangout_hobby]').prop('checked', false)
      $('[name=hangout_date]').val(hangout.date)
      $('[name=hangout_payType]').prop('checked', false)
      $('[name=hangout_allowance]').val(hangout.allowance)
      $('[name=hangout_coupon]').val(hangout.coupon)
    }
    function addHeart( type ){
      switch( type ){ 
        case '+':
          if ( heart.input === 0 ){
            heart.input = 1
          } else {
            heart.input = Math.ceil( (heart.input + 1) / 100 ) * 100
          }
        break;
        case '-':
          if ( heart.input > 100 ){
            heart.input = Math.floor( (heart.input - 1) / 100 ) * 100
          } else if ( heart.input <= 1 ) {
            heart.input = 0
          } else {
            heart.input = 1
          }
        break;
      }
      $('#heart-input').val( heart.input )
      currentHeart()
    }
  </script>

</div>